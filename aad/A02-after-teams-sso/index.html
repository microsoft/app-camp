
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://microsoft.github.io/app-camp/aad/A02-after-teams-sso/">
      
      
        <link rel="prev" href="../A01-begin-app/">
      
      
        <link rel="next" href="../A03-after-apply-styling/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
      
        <title>A02 - Create a Teams app with Azure AD Teams SSO - Teams App Camp</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/labStyles.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="#35258F" data-md-color-accent="#091F2C">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lab-a02-create-a-teams-app-with-azure-ad-single-sign-on" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Teams App Camp" class="md-header__button md-logo" aria-label="Teams App Camp" data-md-component="logo">
      
  <img src="../../assets/microsoftteams_appcamp-webheader3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Teams App Camp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              A02 - Create a Teams app with Azure AD Teams SSO
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/app-camp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/app-camp
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../new-adventure/00-welcome/" class="md-tabs__link">
          
  
  New Adventure

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../A01-begin-app/" class="md-tabs__link">
          
  
  A Path

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../bespoke/B01-begin-app/" class="md-tabs__link">
          
  
  B Path

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ExtendedLabs/" class="md-tabs__link">
          
  
  Extended labs

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Resources/" class="md-tabs__link">
          
  
  Resources

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Teams App Camp" class="md-nav__button md-logo" aria-label="Teams App Camp" data-md-component="logo">
      
  <img src="../../assets/microsoftteams_appcamp-webheader3.png" alt="logo">

    </a>
    Teams App Camp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/app-camp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/app-camp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    New Adventure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            New Adventure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/00-welcome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to another App Camp adventure!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/01-create-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 - Create a new app with Teams Toolkit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/02-integrate-web-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 - Integrate business data with your app
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/03-add-link-unfurling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 - Link Unfurling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/04-add-ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 - Action message extensions with Open AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/05-add-sso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 - Single Sign-on and Microsoft Graph
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/06-run-in-outlook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 - Run your app in Microsoft Outlook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    A Path
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            A Path
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../A01-begin-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A01 - Start with Azure Active Directory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    A02 - Create a Teams app with Azure AD Teams SSO
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    A02 - Create a Teams app with Azure AD Teams SSO
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    <span class="md-ellipsis">
      Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-1-authorize-microsoft-teams-to-log-users-into-your-application" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 1: Authorize Microsoft Teams to log users into your application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercise 1: Authorize Microsoft Teams to log users into your application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-return-to-your-app-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Return to your app registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-add-the-teams-client-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Add the Teams client applications
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-create-the-teams-application-package" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 2: Create the Teams application package
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercise 2: Create the Teams application package">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-copy-the-manifest-folder-to-your-working-directory" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Copy the manifest folder to your working directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-examine-the-manifest-template" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Examine the manifest template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-add-the-teams-app-id-to-the-env-file" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Add the Teams App ID to the .env file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-add-npm-package-to-create-zip-files" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Add npm package to create .zip files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-build-the-package" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Build the package
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-modify-the-application-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 3: Modify the application source code
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercise 3: Modify the application source code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-add-a-module-with-teams-helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Add a module with Teams helper functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-update-the-login-code-for-teams-sso" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Update the login code for Teams SSO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-hide-the-navigation-within-teams" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Hide the navigation within Teams
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-4-test-your-application-in-microsoft-teams" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 4: Test your application in Microsoft Teams
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercise 4: Test your application in Microsoft Teams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-start-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Start the application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-upload-the-app-package" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Upload the app package
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-run-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Run the application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#congratulations" class="md-nav__link">
    <span class="md-ellipsis">
      Congratulations!
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Known issues
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../A03-after-apply-styling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A03 - Teams styling and themes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    B Path
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            B Path
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bespoke/B01-begin-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B01 - Start with a non-Azure Active Directory Identity System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bespoke/B02-after-teams-login/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B02 - Teams App with Bespoke Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bespoke/B03-after-teams-sso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B03 - Enable Azure AD Single Sign-On
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bespoke/B04-after-apply-styling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B04 - Teams styling and themes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Extended labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Extended labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ExtendedLabs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Choose your own adventure!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ConfigurableTab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a configurable tab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Deeplink/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a Deep link to a personal Tab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Dialog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a Dialog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MeetingConfigurableTab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a Meeting app
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MessagingExtension/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a Message Extension
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Monetization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Selling Your SaaS-based Teams Extension
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ExtendTeamsApp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extend teams app to Outlook and Microsoft365 app
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    More Information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../in-a-box/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lead your own App Camp
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "dfh6fjbr5x");
</script>

<p><img alt="Teams App Camp" src="/app-camp/assets/code-lab-banner.png" /></p>
<h1 id="lab-a02-create-a-teams-app-with-azure-ad-single-sign-on">Lab A02: Create a Teams app with Azure AD Single Sign-On</h1>
<h2 id="overview">Overview</h2>
<p>This lab is part of Path A, which begins with a Northwind Orders application that already uses Azure AD.</p>
<details class="note">
<summary>Are you on the right path? Expand these notes to find out!</summary>
<p>There are two options for doing the labs:</p>
<ul>
<li>
<p>The "A" path is for developers with apps that are already based on Azure Active Directory. The starting app uses Azure Active Directory and the Microsoft Authentication Library (MSAL).</p>
</li>
<li>
<p>the "B" path is for developers with apps that use some other identity system. It includes a simple (and not secure!) cookie-based auth system based on the Employees table in the Northwind database. You will use an identity mapping scheme to allow your existing users to log in directly or via Azure AD Single Sign-On.</p>
</li>
</ul>
</details>
<p>In this lab you will extend the Northwind Orders application as a personal tab in a Teams application. That means the application needs to run in an IFrame; if your app includes code that prevents this, you may need to modify it to look for the Teams referrer URL.</p>
<p>The Northwind Orders app doesn't check for IFrames, but Azure AD does, so the existing site won't work without modifications. To accomodate this and to prevent extra user logins, you'll set this tab up to use Teams' Azure AD Single Sign-on. </p>
<p>The completed solution can be found in the <a href="https://github.com/microsoft/app-camp/blob/main/src/create-core-app/aad/A02-after-teams-sso/" target="_blank">A02-after-teams-sso</a> folder, but the instructions will guide you through modifying the app running in your working folder. </p>
<p>Note that as you complete the labs, the original app should still work outside of Teams! This is often a requirement of ISV's who have an app in market and need to serve an existing customer base outside of Teams.</p>
<ul>
<li><a href="../A01-begin-app/">A01-begin-app: Setting up the application with Azure AD</a> </li>
<li><a href="./">A02-after-teams-sso: Creating a Teams app with Azure ADO SSO</a> (ğŸ“You are here)</li>
<li><a href="../A03-after-apply-styling/">A03-after-apply-styling: Teams styling and themes</a></li>
</ul>
<p>In this lab you will learn to:</p>
<ul>
<li>Create an app manifest and package that can be installed into Teams</li>
<li>Update your Azure AD app registration to allow Teams to issue tokens on behalf of your application</li>
<li>Use the Microsoft Teams JavaScript SDK to request an Azure AD access token</li>
<li>Install and test your application in Microsoft Teams</li>
</ul>
<details class="info" open="open">
<summary>Video briefing</summary>
<p><div class="video">
  <iframe src="//www.youtube.com/embed/nMnUZ2PQKBc" frameborder="0" allowfullscreen></iframe>
  <div>Lab A02 Briefing</div>
</div></p>
</details>
<details class="note">
<summary>Table of Contents (open to display â–º)</summary>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#project-structure">Project structure</a></li>
<li><a href="#exercise-1-authorize-microsoft-teams-to-log-users-into-your-application">Exercise 1: Authorize Microsoft Teams to log users into your application</a><ul>
<li><a href="#step-1-return-to-your-app-registration">Step 1: Return to your app registration</a></li>
<li><a href="#step-2-add-the-teams-client-applications">Step 2: Add the Teams client applications</a></li>
</ul>
</li>
<li><a href="#exercise-2-create-the-teams-application-package">Exercise 2: Create the Teams application package</a><ul>
<li><a href="#step-1-copy-the-manifest-folder-to-your-working-directory">Step 1: Copy the <em>manifest</em> folder to your working directory</a></li>
<li><a href="#step-2-examine-the-manifest-template">Step 2: Examine the manifest template</a></li>
<li><a href="#step-3-add-the-teams-app-id-to-the-env-file">Step 3: Add the Teams App ID to the .env file</a></li>
<li><a href="#step-4-add-npm-package-to-create-zip-files">Step 4: Add npm package to create .zip files</a></li>
<li><a href="#step-5-build-the-package">Step 5: Build the package</a></li>
</ul>
</li>
<li><a href="#exercise-3-modify-the-application-source-code">Exercise 3: Modify the application source code</a><ul>
<li><a href="#step-1-add-a-module-with-teams-helper-functions">Step 1: Add a module with Teams helper functions</a></li>
<li><a href="#step-2-update-the-login-code-for-teams-sso">Step 2: Update the login code for Teams SSO</a></li>
<li><a href="#step-3-hide-the-navigation-within-teams">Step 3: Hide the navigation within Teams</a></li>
<li><a href="#exercise-4-test-your-application-in-microsoft-teams">Exercise 4: Test your application in Microsoft Teams</a></li>
<li><a href="#step-1-start-the-application">Step 1: Start the application</a></li>
<li><a href="#step-2-upload-the-app-package">Step 2: Upload the app package</a></li>
</ul>
</li>
<li><a href="#known-issues">Known issues</a></li>
<li><a href="#references">References</a></li>
<li><a href="#next-steps">Next Steps</a></li>
</ul>
</details>
<h2 id="features">Features</h2>
<ul>
<li>Microsoft Teams personal tab application displays the Northwind Orders web application</li>
<li>Users sign into the Teams application transparently using Azure AD SSO</li>
<li>Application alters its appearance (hides the top navigation) when running in Teams, allowing Teams tab navigation instead</li>
</ul>
<h2 id="project-structure">Project structure</h2>
<details class="note">
<summary>Project files before and after this lab (open to display â–º)</summary>
<p>The project structure when you start of this lab and end of this lab is as follows.
Use this depiction for comparison.
On your left is the contents of folder  <code>A01-begin-app</code> and on your right is the contents of folder <code>A02-after-teams-sso</code>.</p>
<ul>
<li>
<p>ğŸ†• New files/folders</p>
</li>
<li>
<p>ğŸ”ºFiles changed</p>
</li>
</ul>
<p><table>
<tr>
<th >Project Structure Before </th>
<th>Project Structure After</th>
</tr>
<tr>
<td valign="top" >
<pre>
A01-begin-app
    â”œâ”€â”€ client
    â”‚   â”œâ”€â”€ components
    â”‚       â”œâ”€â”€ ğŸ”ºnavigation.js
    â”‚   â””â”€â”€ identity
    â”‚       â”œâ”€â”€ ğŸ”ºidentityClient.js
    â”‚       â””â”€â”€ userPanel.js
    â”œâ”€â”€ modules
    â”‚   â””â”€â”€ env.js
    â”‚   â””â”€â”€ northwindDataService.js
    â”œâ”€â”€ pages
    â”‚   â””â”€â”€ categories.html
    â”‚   â””â”€â”€ categories.js
    â”‚   â””â”€â”€ categoryDetails.html
    â”‚   â””â”€â”€ categoryDetails.js
    â”‚   â””â”€â”€ myOrders.html
    â”‚   â””â”€â”€ orderDetail.html
    â”‚   â””â”€â”€ orderDetail.js
    â”‚   â””â”€â”€ privacy.html
    â”‚   â””â”€â”€ productDetail.html
    â”‚   â””â”€â”€ productDetail.js
    â”‚   â””â”€â”€ termsofuse.html
    â”œâ”€â”€ index.html
    â”œâ”€â”€ index.js
    â”œâ”€â”€ northwind.css
    â”œâ”€â”€ server
    â”‚   â””â”€â”€ constants.js
    â”‚   â””â”€â”€ identityService.js
    â”‚   â””â”€â”€ northwindDataService.js
    â”‚   â””â”€â”€ server.js
    â”œâ”€â”€ ğŸ”º.env_Sample
    â”œâ”€â”€ .gitignore
    â”œâ”€â”€ ğŸ”ºpackage.json
    â”œâ”€â”€ README.md
</pre>
</td>
<td>
<pre>
A02-after-teams-sso
    â”œâ”€â”€ client
    â”‚   â”œâ”€â”€ components
    â”‚       â”œâ”€â”€ ğŸ”ºnavigation.js
    â”‚   â””â”€â”€ identity
    â”‚       â”œâ”€â”€ ğŸ”ºidentityClient.js
    â”‚       â””â”€â”€ userPanel.js
    â”œâ”€â”€ modules
    â”‚   â””â”€â”€ env.js
    â”‚   â””â”€â”€ northwindDataService.js
    â”‚   â””â”€â”€ ğŸ†•teamsHelpers.js
    â”œâ”€â”€ pages
    â”‚   â””â”€â”€ categories.html
    â”‚   â””â”€â”€ categories.js
    â”‚   â””â”€â”€ categoryDetails.html
    â”‚   â””â”€â”€ categoryDetails.js
    â”‚   â””â”€â”€ myOrders.html
    â”‚   â””â”€â”€ orderDetail.html
    â”‚   â””â”€â”€ orderDetail.js
    â”‚   â””â”€â”€ privacy.html
    â”‚   â””â”€â”€ productDetail.html
    â”‚   â””â”€â”€ productDetail.js
    â”‚   â””â”€â”€ termsofuse.html
    â”œâ”€â”€ index.html
    â”œâ”€â”€ index.js
    â”œâ”€â”€ northwind.css
    â”œâ”€â”€ ğŸ†•manifest
    â”‚   â””â”€â”€ ğŸ†•makePackage.js
    â”‚   â””â”€â”€ ğŸ†•manifest.template.json
    â”‚   â””â”€â”€ ğŸ†•northwind32.png
    â”‚   â””â”€â”€ ğŸ†•northwind192.png
    â”œâ”€â”€ server
    â”‚   â””â”€â”€ constants.js
    â”‚   â””â”€â”€ identityService.js
    â”‚   â””â”€â”€ northwindDataService.js
    â”‚   â””â”€â”€ server.js
    â”œâ”€â”€ ğŸ”º.env_Sample
    â”œâ”€â”€ .gitignore
    â”œâ”€â”€ ğŸ”ºpackage.json
    â”œâ”€â”€ README.md
</pre>
</td>
</tr>
</table></p>
</details>
<h2 id="exercise-1-authorize-microsoft-teams-to-log-users-into-your-application">Exercise 1: Authorize Microsoft Teams to log users into your application</h2>
<p>The starting application logs users into Azure Active Directory using the <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-overview?WT.mc_id=m365-58890-cxa" target="_blank">Microsoft Authentication Library (MSAL)</a>. While this works well in a web browser, it won't work reliably in a Microsoft Teams application. Instead, Microsoft Teams provides a Single Sign-On (SSO) capability so users are silently logged into your application using the same credentials they used to log into Microsoft Teams. This requires giving Microsoft Teams permission to issue Azure AD tokens on behalf of your application. In this exercise, you'll provide that permission.</p>
<h3 id="step-1-return-to-your-app-registration">Step 1: Return to your app registration</h3>
<p>Return to the <a href="https://aad.portal.azure.com/" target="_blank">Azure AD admin portal</a> and make sure you're logged in as the administrator of your development tenant. Click "Azure Active Directory" 1ï¸âƒ£ and then "App Registrations" 2ï¸âƒ£.</p>
<p><img alt="Return to your app registration" src="/app-camp/assets/screenshots/03-001-AppRegistrationUpdate-1.png" /></p>
<p>Select the app you registered earlier to view the application overview.</p>
<h3 id="step-2-add-the-teams-client-applications">Step 2: Add the Teams client applications</h3>
<p>Click "Expose an API" 1ï¸âƒ£ and then "+ Add a client application" 2ï¸âƒ£.</p>
<p><img alt="Open the Expose an API screen" src="/app-camp/assets/screenshots/03-002-AppRegistrationUpdate-2.png" /></p>
<p>Paste the ID for the Teams mobile or desktop app, which is <code>1fec8e78-bce4-4aaf-ab1b-5451cc387264</code>, into the Client ID field in the flyout 1ï¸âƒ£ and check the scope you created earlier 2ï¸âƒ£ to allow Teams to issue tokens for that scope. Then click "Add application" 3ï¸âƒ£ to save your work.</p>
<p>Repeat the process for the Teams web application, <code>5e3ce6c0-2b1f-4285-8d4b-75ee78787346</code>.</p>
<p><img alt="Add a client application" src="/app-camp/assets/screenshots/03-003-AppRegistrationUpdate-3.png" /></p>
<div class="admonition warning these are the actual guids to use">
<p class="admonition-title">Warning</p>
<p>These app ID's, <code>1fec8e78-bce4-4aaf-ab1b-5451cc387264</code> and <code>5e3ce6c0-2b1f-4285-8d4b-75ee78787346</code>, are the exact ID's you should use; they are not examples. These are the ID's for the Teams mobile/desktop app and Teams web app that are registered in Microsoft's tenant for use by every customer who uses Microsoft Teams.</p>
</div>
<h2 id="exercise-2-create-the-teams-application-package">Exercise 2: Create the Teams application package</h2>
<p>Microsoft Teams applications don't run "inside" of Microsoft Teams, they just appear in the Teams user interface. A tab in Teams is just a web page, which could be hosted anywhere as long as the Teams client can reach it. </p>
<p>To create a Teams application, you need to create a file called <em>manifest.json</em> which contains <a href="https://docs.microsoft.com/en-us/microsoftteams/platform/resources/schema/manifest-schema" target="_blank">the information Teams needs to display the app</a>, such as the URL of the Northwind Orders application. This file is placed in a .zip file along with the application icons, and the resulting application package is uploaded into Teams or distributed through the Teams app store.</p>
<p>In this exercise you'll create a manifest.json file and application package for the Northwind Orders app and upload it into Microsoft Teams.</p>
<h3 id="step-1-copy-the-manifest-folder-to-your-working-directory">Step 1: Copy the <em>manifest</em> folder to your working directory</h3>
<p>Many developers use the <a href="https://docs.microsoft.com/en-us/microsoftteams/platform/concepts/build-and-test/teams-developer-portal?WT.mc_id=m365-58890-cxa" target="_blank">Teams Developer Portal</a> to create an app package; this is preferred by many enterprise developer and systems integrators. However ISV's may want to keep the app package settings in their source control system, and that's the approach used in the lab. It's just a zip file; you can create it any way you want!</p>
<div class="admonition note">
<p class="admonition-title">The Teams developer portal is important even if you generate your own app package!</p>
<p>Import your pacakge into the Teams Developer Portal to run validation checks prior to submitting it to the Teams app store! If you do this periodically during development you can catch issues earlier and avoid rework.</p>
</div>
<p>Go to your local copy of the <code>A02-TeamsSSO</code> folder on your computer and copy the <em>manifest</em> folder into the working folder you used in the previous lab. This folder contains a template for building the manifest.json file.</p>
<h3 id="step-2-examine-the-manifest-template">Step 2: Examine the manifest template</h3>
<p>In the manifest folder you just copied, open <a href="https://github.com/microsoft/app-camp/blob/main/src/create-core-app/aad/A02-after-teams-sso/manifest/manifest.template.json" target="_blank">manifest.template.json</a> in your code editor. This is the JSON that Teams needs to display your application.</p>
<p>Notice that the template contains tokens such as<code>&lt;HOST_NAME&gt;</code> and <code>&lt;CLIENT_ID&gt;</code>. A small build script will take these values from your .env file and plug them into the manifest. However there's one token, <code>&lt;TEAMS_APP_ID&gt;</code> that's not yet in the .env file; we'll add that in the next step.</p>
<p>Examine the <code>staticTabs</code> property in the manifest. It defines two tabs, one for the "My Orders" page and one for the "Products" page. The <code>contentUrl</code> is used within the Teams application, and <code>websiteUrl</code> is used if Teams can't render the tab and needs to launch it in a regular web browser. The Northwind Orders app will use the same code URL's for both.</p>
<pre><code class="language-json">&quot;staticTabs&quot;: [
  {
    &quot;entityId&quot;: &quot;Orders&quot;,
    &quot;name&quot;: &quot;My Orders&quot;,
    &quot;contentUrl&quot;: &quot;https://&lt;HOST_NAME&gt;/pages/myOrders.html&quot;,
    &quot;websiteUrl&quot;: &quot;https://&lt;HOST_NAME&gt;/pages/myOrders.html&quot;,
    &quot;scopes&quot;: [
      &quot;personal&quot;
    ]
  },
  {
    &quot;entityId&quot;: &quot;Products&quot;,
    &quot;name&quot;: &quot;Products&quot;,
    &quot;contentUrl&quot;: &quot;https://&lt;HOST_NAME&gt;/pages/categories.html&quot;,
    &quot;websiteUrl&quot;: &quot;https://&lt;HOST_NAME&gt;/pages/categories.html&quot;,
    &quot;scopes&quot;: [
      &quot;personal&quot;
    ]

</code></pre>
<p>Now examine the <code>webApplicationInfo</code> property. It contains the information Teams needs to obtain an access token using Single Sign On.</p>
<pre><code class="language-json">  &quot;webApplicationInfo&quot;: {
      &quot;id&quot;: &quot;&lt;CLIENT_ID&gt;&quot;,
      &quot;resource&quot;: &quot;api://&lt;HOST_NAME&gt;/&lt;CLIENT_ID&gt;&quot;
  }
</code></pre>
<h3 id="step-3-add-the-teams-app-id-to-the-env-file">Step 3: Add the Teams App ID to the .env file</h3>
<p>Open the .env file in your working directory and add this line to the values from <a href="/app-camp/aad/A01-begin-app/#step-4-configure-the-app-settings" target="_blank">Lab A01</a>:</p>
<pre><code class="language-text">TEAMS_APP_ID=1331dbd6-08eb-4123-9713-017d9e0fc04a
</code></pre>
<p>Be sure to complete the line by placing an end of line character at the end (using the enter key in your text editor).</p>
<p>You should generate a different GUID for each application you register; this one is just here for your convenience. We could have hard-coded the app ID in the manifest.json template, but there are times when you need it in your code, so this will make that possible in the future. You can generate a new GUID at <a href="https://www.guidgen.com/" target="_blank">this website</a></p>
<h3 id="step-4-add-npm-package-to-create-zip-files">Step 4: Add npm package to create .zip files</h3>
<p>Run this command in your working application folder:</p>
<pre><code class="language-shell">npm install adm-zip --save-dev
</code></pre>
<h3 id="step-5-build-the-package">Step 5: Build the package</h3>
<p>Open the <strong>package.json</strong> file in your working directory and add a script that will generate the app package. The <a href="https://github.com/microsoft/app-camp/blob/main/src/create-core-app/aad/A02-after-teams-sso/manifest/makePackage.js" target="_blank">script code</a> is in the manifest folder you just copied, so we just need to declare it in package.json. This is what <code>scripts</code> property should look like when you're done.</p>
<pre><code class="language-json">&quot;scripts&quot;: {
  &quot;start&quot;: &quot;nodemon server/server.js&quot;,
  &quot;debug&quot;: &quot;nodemon --inspect server/server.js&quot;,
  &quot;db-download&quot;: &quot;node northwindDB/dbDownload.js&quot;,
  &quot;package&quot;: &quot;node manifest/makePackage.js&quot;
},
</code></pre>
<p>Now you can build a new package at any time with this command:</p>
<pre><code class="language-shell">npm run package
</code></pre>
<p>Go ahead and run it, and two new files, manifest.json and northwind.zip (the app package) should appear in your manifest folder.</p>
<h2 id="exercise-3-modify-the-application-source-code">Exercise 3: Modify the application source code</h2>
<h3 id="step-1-add-a-module-with-teams-helper-functions">Step 1: Add a module with Teams helper functions</h3>
<p>Create a file called <code>teamsHelpers.js</code> in the <code>client/modules folder</code>, and paste in this code:</p>
<pre><code class="language-javascript">import 'https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js';

// Ensure that the Teams SDK is initialized once no matter how often this is called
let teamsInitPromise;
export function ensureTeamsSdkInitialized() {
    if (!teamsInitPromise) {
        teamsInitPromise = microsoftTeams.app.initialize();
    }
    return teamsInitPromise;
}

// Function returns a promise which resolves to true if we're running in Teams
export async function inTeams() {
    try {
        await ensureTeamsSdkInitialized();
        const context = await microsoftTeams.app.getContext();
        return (context.app.host.name === microsoftTeams.HostName.teams);
    }
    catch (e) {
        console.log(`${e} from Teams SDK, may be running outside of Teams`);    
        return false;
    }
}
</code></pre>
<p>These functions are used throughout the application to manage the Microsoft Teams JavaScript SDK.</p>
<p>Before using the Microsoft Teams JavaScript SDK for the first time on a page, you need to call the <a href="https://docs.microsoft.com/en-us/javascript/api/@microsoft/teams-js/app?view=msteams-client-js-latest?WT.mc_id=m365-58890-cxa#@microsoft-teams-js-app-initialize" target="_blank"><code>microsoftTeams.app.initialize()</code> function</a>. The first function in <strong>teamsHelpers.js</strong> will ensure that <code>initialize()</code> has been called exactly once on the page.W</p>
<p>The <code>inTeams()</code> function is used to determine if the application is running in Microsoft Teams or not. You may want to check out the <a href="https://docs.microsoft.com/en-us/javascript/api/@microsoft/teams-js/hostname?WT.mc_id=m365-58890-cxa" target="_blank"><code>microsoftTeams.Hostname</code> enumeration</a> to see other places where Teams applications will be able to run in the near future!</p>
<h3 id="step-2-update-the-login-code-for-teams-sso">Step 2: Update the login code for Teams SSO</h3>
<p>Open the <code>client/identity/identityClient.js</code> file and add these import statements near the top.</p>
<pre><code class="language-javascript">import { ensureTeamsSdkInitialized, inTeams } from '/modules/teamsHelpers.js';
import 'https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js';
</code></pre>
<p>The first import, of course, is the Teams helper functions we just added. It's a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules" target="_blank">JavaScript module</a> so there is no bundling; the browser will resolve the import at runtime. </p>
<p>The second import will load the Teams JavaScript SDK, which creates a global object <code>microsoftTeams</code> that we can use to access the SDK. You could also load it using a <code>&lt;script&gt;</code> tag or, if you bundle your client-side JavaScript, using the <a href="https://www.npmjs.com/package/@microsoft/teams-js" target="_blank">@microsoft/teams-js</a> npm package.</p>
<p>Now modify the <code>getAccessToken2()</code> function to include this code at the top:</p>
<pre><code class="language-javascript">    if (await inTeams()) {        

        await ensureTeamsSdkInitialized();
        return await microsoftTeams.authentication.getAuthToken();  

    } else {
      // existing code
    }
</code></pre>
<p>This code checks to see if it's running in Teams and if so, uses the Teams JavaScript SDK's <code>getAuthToken()</code> function to get the access token needed to call the server.</p>
<p>The completed <code>getAccessToken2()</code> function should look like this:</p>
<pre><code class="language-javascript">async function getAccessToken2() {

    if (await inTeams()) {    

        await ensureTeamsSdkInitialized();
        return await microsoftTeams.authentication.getAuthToken();

    } else {

        // If we were waiting for a redirect with an auth code, handle it here
        await msalClient.handleRedirectPromise();

        try {
            await msalClient.ssoSilent(msalRequest);
        } catch (error) {
            await msalClient.loginRedirect(msalRequest);
        }

        const accounts = msalClient.getAllAccounts();
        if (accounts.length === 1) {
            msalRequest.account = accounts[0];
        } else {
            throw (&quot;Error: Too many or no accounts logged in&quot;);
        }

        let accessToken;
        try {
            const tokenResponse = await msalClient.acquireTokenSilent(msalRequest);
            accessToken = tokenResponse.accessToken;
            return accessToken;
        } catch (error) {
            if (error instanceof msal.InteractionRequiredAuthError) {
                console.warn(&quot;Silent token acquisition failed; acquiring token using redirect&quot;);
                this.msalClient.acquireTokenRedirect(this.request);
            } else {
                throw (error);
            }
        }
    }
}
</code></pre>
<p>Finally, update the logoff function to disable logging off if it's running in Teams.</p>
<pre><code class="language-javascript">export async function logoff() {
    getLoggedInEmployeeIdPromise = null;
    getAccessTokenPromise = null;

    if (!(await inTeams())) {
        msalClient.logoutRedirect(msalRequest);
    }
}
</code></pre>
<h3 id="step-3-hide-the-navigation-within-teams">Step 3: Hide the navigation within Teams</h3>
<p>Microsoft Teams already has multiple levels of navigation, including multiple tabs as configured in the previous exercise. So the applications' built-in navigation is redundant in Teams.</p>
<p>To hide the built-in navigation in Teams, open the <code>client/components/navigation.js</code> file and add this import statement at the top.</p>
<pre><code class="language-javascript">import { inTeams } from '../modules/teamsHelpers.js';
</code></pre>
<p>Now modify the <code>connectedCallback()</code> function, which displays the navigation web component, to skip rendering if it's running in Teams. The resulting function should look like this:</p>
<pre><code class="language-javascript">    async connectedCallback() {

        if (!(await inTeams())) {
            let listItemHtml = &quot;&quot;;
            topNavLinks.forEach(link =&gt; {
                if (window.location.href.indexOf(link.url) &lt; 0) {
                    listItemHtml += '&lt;li&gt;&lt;a href=&quot;' + link.url + '&quot;&gt;' + link.text + '&lt;/a&gt;&lt;/li&gt;';
                } else {
                    return listItemHtml += '&lt;li&gt;&lt;a href=&quot;' + link.url + '&quot; class=&quot;selected&quot;&gt;' + link.text + '&lt;/a&gt;&lt;/li&gt;';
                }
            });
            this.innerHTML = `
                &lt;ul class=&quot;topnav&quot;&gt;${listItemHtml}&lt;/ul&gt;
            `;
        }

    }
</code></pre>
<div class="admonition info">
<p class="admonition-title">About web components</p>
<p>Web components are encapsulated custom HTML elements. They're not a Teams thing, nor do they use React or another UI library; they're built right into modern web browsers! You can learn more <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components." target="_blank">in this article</a></p>
</div>
<h2 id="exercise-4-test-your-application-in-microsoft-teams">Exercise 4: Test your application in Microsoft Teams</h2>
<h3 id="step-1-start-the-application">Step 1: Start the application</h3>
<p>Now it's time to run your updated application and run it in Microsoft Teams. Start the application with this command:</p>
<pre><code class="language-shell">npm start
</code></pre>
<h3 id="step-2-upload-the-app-package">Step 2: Upload the app package</h3>
<p>In the Teams web or desktop UI, click "Apps" in the sidebar 1ï¸âƒ£, then "Manage your apps" 2ï¸âƒ£. At this point you have three choices:</p>
<ul>
<li>Upload a custom app (upload the app for yourself or a specific team or group chat) - this only appears if you have enabled "Upload custom apps" in your setup policy; this was a step in the previous lab</li>
<li>Upload an app to your org's app catalog (upload the app for use within your organization) - this only appears if you are a tenant administrator</li>
<li>Submit an app to your org (initiate a workflow asking a tenant administrator to install your app) - this appears for everyone</li>
</ul>
<p>In this case, choose the first option 3ï¸âƒ£.</p>
<p><img alt="Upload the app" src="/app-camp/assets/screenshots/03-005-InstallApp-1.png" /></p>
<p>Navigate to the Northwind.zip file in your manifest directory and upload it. Teams will display the application information; click the "Add" button to install it for your personal use.</p>
<p><img alt="Upload the app" src="/app-camp/assets/screenshots/03-006-InstallApp-2.png" /></p>
<h3 id="step-3-run-the-application">Step 3: Run the application</h3>
<p>The application should appear without any login prompt. The app's navigation should not be displayed; instead users can navigate to "My Orders" or "Products" using the tabs in the Teams app.</p>
<p><img alt="Run the app" src="/app-camp/assets/screenshots/03-007-RunApp-1.png" /></p>
<script language="javascript">
    function showCompletionPopup() {
        let path = window.location.pathname;
        path = path.endsWith('/') ? path.slice(0, -1) : path;
        let pathArray = path.split('/');
        let leafFolder = pathArray[pathArray.length-1];

        let height = window.outerHeight / 1.5;
        let width = window.outerWidth / 2;

        window.open(`${window.origin}/app-camp/congrats/${leafFolder}`,
                    'Congratulations!',
                    `width=${width}, height=${height}, left=100, top=100,`);
    }
</script>

<h2 id="congratulations">Congratulations!</h2>
<p><button type="button" onclick="showCompletionPopup();" class="largeButton">When you have finished this lab,<br />please click this button to let us know!</button></p>
<p>No personal information is collected; we only want to count how many people have completed the labs so we can continue to fund this work!</p>

<div class="admonition check">
<p class="admonition-title">Challenge</p>
<p>You might have noticed the logout button doesn't do anything in Teams! If you wish, hide the logout button just as you hid the navigation bar. The code is in client/identity/userPanel.js.</p>
</div>
<h2 id="known-issues">Known issues</h2>
<p>While it will work on mobile devices, the application is not responsive and will not look good on these devices. This may be addressed in a future version of the lab.</p>
<p>For the latest issues, or to file a bug report, see the <a href="https://github.com/microsoft/app-camp/issues" target="_blank">GitHub issues list</a> for this repository.</p>
<h2 id="references">References</h2>
<p><a href="https://docs.microsoft.com/microsoftteams/platform/tabs/how-to/authentication/auth-aad-sso?WT.mc_id=m365-58890-cxa">Single sign-on (SSO) support for Tabs</a></p>
<h2 id="next-steps">Next Steps</h2>
<p>After completing this lab, you may continue to the next lab in this learning path, <a href="../A03-after-apply-styling/" target="_blank">A03-after-apply-styling: Teams styling and themes</a>.</p>
<p><img src="https://pnptelemetry.azurewebsites.net/app-camp/labs/a02" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>